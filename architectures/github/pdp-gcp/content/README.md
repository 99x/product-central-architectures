## PDP on GCP with Terraform

This document outlines deploying a Product Central instance using Terraform scripts on GCP infrastructure. 

**Services Used:**

The specific GCP services used will depend on the chosen deployment configuration in the Terraform scripts.

* Cloud SQL - For PostgreSQL database.
* Google Cloud Run - To host and run run serverless container application.
* VPC (tbc)

**IAM Roles for Service Account**

* Artifact Registry Reader
* Cloud Run Admin
* Cloud SQL Admin
* Cloud SQL Client
* Cloud SQL Editor
* Service Account User

**Important Note:**
* Once deployment is complete, access the associated Github Oauth Application  and configure settings like:
    * **Homepage URL:** Update the homepage URL to point to the public DNS name of the deployed application.
    * **Auth Callback URL:** Configure the Auth Callback URL to match the endpoint generated by your GCP deployment for authentication redirects.
        - `<DNS>/api/auth/github/handler/frame`


## Running Terraform Script Locally

**Prerequisites**

1. Install Terraform: Terraform is used to automate the creation and management of infrastructure. You can download it from the official website and follow the instructions for your operating system.
2. Install jq: jq is a lightweight and flexible command-line JSON processor. It's used in this project to parse JSON data. You can download it from the official website and follow the instructions for your operating system.

**Steps**

1. Create env.json file: Create a new file named env.json in the root of the project. This file should contain all the environment variables needed for the script. You can use the `env-example.json` file as a template. Make sure to replace the placeholder values with your actual data.

2. Run the script: You can now run the apply.sh script to create the infrastructure:

```sh
./apply.sh "$(cat env.json)"
```

This command reads the contents of the env.json file and passes it as an argument to the apply.sh script. The script then parses the JSON data and uses it to set the environment variables.

3. Destroy the infrastructure: Once you're done testing, you can destroy the infrastructure to avoid unnecessary charges:
This command works the same way as the apply.sh script, but it destroys the infrastructure instead of creating it.

```sh
./destroy.sh "$(cat env.json)"
```